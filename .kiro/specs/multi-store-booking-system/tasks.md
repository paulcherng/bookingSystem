# 實作計畫

- [x] 1. 專案初始化和基礎設定


  - 建立 Next.js 14 專案結構
  - 設定 TypeScript、Tailwind CSS、ESLint
  - 配置 Vercel 部署設定檔案
  - 設定環境變數範本
  - _需求: 9.1, 9.2_

- [ ]* 1.1 設定測試框架
  - 安裝和配置 Jest、React Testing Library
  - 安裝和配置 fast-check 屬性測試庫
  - 建立測試工具和 mock 設定
  - _需求: 所有測試相關需求_

- [x] 2. 資料庫設計和設定


  - 建立 Prisma schema 定義
  - 實作資料庫遷移腳本
  - 設定 Vercel Postgres 連接
  - 建立種子資料腳本
  - _需求: 1.1, 3.1, 4.1, 5.1_

- [ ]* 2.1 寫入資料模型屬性測試
  - **屬性 1: 店家帳戶創建一致性**
  - **驗證需求: 1.1, 1.2, 1.3**

- [ ]* 2.2 寫入資料庫操作單元測試
  - 測試 CRUD 操作
  - 測試資料驗證
  - 測試關聯性約束
  - _需求: 1.1, 3.1, 4.1, 5.1_

- [ ] 3. 核心資料模型實作
  - [x] 3.1 實作 Store 模型和服務


    - 建立店家註冊、更新、查詢功能
    - 實作店家資料驗證邏輯
    - _需求: 1.1, 1.2, 1.4_

  - [ ]* 3.2 寫入店家管理屬性測試
    - **屬性 1: 店家帳戶創建一致性**
    - **驗證需求: 1.1, 1.2, 1.3**

  - [x] 3.3 實作 BusinessHours 模型和服務


    - 建立營業時段設定功能
    - 實作時段驗證和衝突檢查
    - _需求: 3.1, 3.2, 3.3_

  - [ ]* 3.4 寫入營業時段屬性測試
    - **屬性 3: 營業時段約束**
    - **驗證需求: 3.1, 3.2, 3.3**

  - [x] 3.5 實作 Barber 模型和服務


    - 建立理髮師管理功能
    - 實作理髮師行事曆創建
    - _需求: 4.1, 4.2, 4.3_

  - [ ]* 3.6 寫入理髮師管理屬性測試
    - **屬性 4: 理髮師行事曆獨立性**
    - **驗證需求: 4.1, 4.3**

  - [x] 3.7 實作 Service 模型和服務


    - 建立服務項目管理功能
    - 實作服務時間驗證
    - _需求: 5.1, 5.2, 5.3, 5.4_

  - [ ]* 3.8 寫入服務管理屬性測試
    - **屬性 5: 服務項目資料一致性**
    - **驗證需求: 5.1, 5.2, 5.3**
    - **屬性 11: 服務時間格式驗證**
    - **驗證需求: 5.4**

- [x] 4. 檢查點 - 確保所有測試通過


  - 確保所有測試通過，如有問題請詢問使用者

- [ ] 5. 認證和授權系統
  - [x] 5.1 設定 NextAuth.js


    - 配置認證提供者
    - 實作會話管理
    - 建立登入/登出頁面
    - _需求: 1.1_

  - [x] 5.2 實作角色基礎存取控制



    - 建立權限中介軟體
    - 實作店家資料存取控制
    - _需求: 1.1_

  - [ ]* 5.3 寫入認證系統單元測試
    - 測試登入流程
    - 測試權限控制
    - 測試會話管理
    - _需求: 1.1_

- [ ] 6. 通訊整合系統
  - [x] 6.1 實作 LINE Bot 整合


    - 設定 LINE Bot API 連接
    - 實作 webhook 接收端點
    - 建立訊息發送服務
    - _需求: 2.1, 2.3, 6.1, 8.3_

  - [ ]* 6.2 寫入 LINE 整合屬性測試
    - **屬性 2: 通訊管道連結驗證**
    - **驗證需求: 2.1, 2.3**

  - [x] 6.3 實作電子郵件整合


    - 設定 SendGrid API 連接
    - 實作郵件接收 webhook
    - 建立郵件發送服務
    - _需求: 2.2, 2.4, 6.2, 8.4_

  - [ ]* 6.4 寫入電子郵件整合屬性測試
    - **屬性 2: 通訊管道連結驗證**
    - **驗證需求: 2.2, 2.4**

  - [x] 6.5 實作訊息解析服務


    - 建立自然語言處理邏輯
    - 實作預約資訊提取
    - 處理格式錯誤和模糊訊息
    - _需求: 6.3, 6.4, 6.5_

  - [ ]* 6.6 寫入訊息解析屬性測試
    - **屬性 6: 訊息解析通用性**
    - **驗證需求: 6.1, 6.2, 6.3**

- [ ] 7. 預約管理核心邏輯
  - [x] 7.1 實作行事曆服務


    - 建立行事曆查詢功能
    - 實作時段可用性檢查
    - 處理多理髮師排程
    - _需求: 7.1, 7.2, 7.4_

  - [ ]* 7.2 寫入理髮師分配屬性測試
    - **屬性 7: 理髮師分配邏輯**
    - **驗證需求: 7.1, 7.2**

  - [x] 7.3 實作預約衝突檢測


    - 建立時段衝突檢查邏輯
    - 實作服務時間驗證
    - 整合營業時間約束
    - _需求: 7.3, 7.5_

  - [ ]* 7.4 寫入衝突檢測屬性測試
    - **屬性 8: 時段衝突檢測**
    - **驗證需求: 7.3, 7.4, 7.5**

  - [x] 7.5 實作預約建立服務


    - 建立預約創建邏輯
    - 實作預約狀態管理
    - 處理預約取消和修改
    - _需求: 8.1, 8.2_

  - [ ]* 7.6 寫入預約管理屬性測試
    - **屬性 9: 自動回覆一致性**
    - **驗證需求: 8.1, 8.2**

- [ ] 8. 自動回覆系統
  - [x] 8.1 實作回覆生成服務


    - 建立回覆訊息範本
    - 實作動態內容生成
    - 處理多語言支援
    - _需求: 8.1, 8.2_

  - [x] 8.2 實作通知發送服務


    - 整合 LINE 和郵件發送
    - 實作重試機制
    - 處理發送失敗
    - _需求: 8.3, 8.4, 8.5_

  - [ ]* 8.3 寫入通訊回覆屬性測試
    - **屬性 10: 通訊管道回覆對應**
    - **驗證需求: 8.3, 8.4**

- [x] 9. 檢查點 - 確保所有測試通過


  - 確保所有測試通過，如有問題請詢問使用者

- [ ] 10. 店家管理介面
  - [x] 10.1 建立店家儀表板


    - 實作店家概覽頁面
    - 建立預約列表和狀態顯示
    - 實作即時更新功能
    - _需求: 4.5_

  - [x] 10.2 建立理髮師管理頁面


    - 實作理髮師 CRUD 介面
    - 建立行事曆檢視
    - 實作理髮師狀態管理
    - _需求: 4.1, 4.2, 4.3, 4.5_


  - [x] 10.3 建立服務管理頁面

    - 實作服務項目 CRUD 介面
    - 建立服務時間設定
    - 實作服務狀態管理
    - _需求: 5.1, 5.2, 5.3, 5.4_

  - [x] 10.4 建立營業時段設定頁面


    - 實作營業時間設定介面
    - 建立特殊日期管理
    - 實作時段預覽功能
    - _需求: 3.1, 3.2, 3.5_


  - [x] 10.5 建立通訊設定頁面


    - 實作 LINE Bot 設定介面
    - 建立郵件設定管理
    - 實作連接狀態檢查
    - _需求: 2.1, 2.2, 2.5_

- [ ]* 10.6 寫入前端元件單元測試
  - 測試使用者介面互動
  - 測試表單驗證
  - 測試資料顯示
  - _需求: 所有前端相關需求_

- [ ] 11. API 端點實作
  - [x] 11.1 實作店家管理 API



    - 建立店家 CRUD 端點
    - 實作資料驗證中介軟體
    - 處理錯誤回應
    - _需求: 1.1, 1.2, 1.4_

  - [x] 11.2 實作預約管理 API


    - 建立預約 CRUD 端點
    - 實作可用性查詢端點
    - 處理批次操作
    - _需求: 7.1, 7.2, 8.1, 8.2_

  - [x] 11.3 實作 Webhook 端點


    - 建立 LINE webhook 處理器
    - 實作郵件 webhook 處理器
    - 加入簽名驗證
    - _需求: 6.1, 6.2, 9.3, 9.4_

  - [ ]* 11.4 寫入 API 整合測試
    - 測試完整的預約流程
    - 測試錯誤處理
    - 測試效能表現
    - _需求: 所有 API 相關需求_

- [x] 12. 錯誤處理和日誌系統






  - [x] 12.1 實作全域錯誤處理

    - 建立錯誤分類系統
    - 實作錯誤回應格式化
    - 處理未捕獲的例外
    - _需求: 8.5_

  - [x] 12.2 實作日誌和監控


    - 建立結構化日誌
    - 實作效能監控
    - 設定錯誤追蹤
    - _需求: 9.5_

  - [ ]* 12.3 寫入錯誤處理單元測試
    - 測試各種錯誤情況
    - 測試重試機制
    - 測試日誌記錄
    - _需求: 8.5_

- [x] 13. 部署準備和設定





  - [x] 13.1 建立 Vercel 設定檔案

    - 配置 vercel.json
    - 設定環境變數
    - 配置建置設定
    - _需求: 9.1, 9.2_


  - [x] 13.2 建立資料庫遷移腳本

    - 實作生產環境遷移
    - 建立資料備份腳本
    - 設定自動遷移
    - _需求: 9.2_


  - [x] 13.3 實作健康檢查端點

    - 建立系統狀態檢查
    - 實作資料庫連接檢查
    - 建立外部服務檢查
    - _需求: 9.5_

- [ ]* 13.4 寫入部署驗證測試
  - 測試 HTTP 端點回應
  - 測試 webhook 處理
  - 測試健康檢查
  - _需求: 9.2, 9.3, 9.4, 9.5_

- [ ] 14. 文件建立
  - [x] 14.1 建立部署指南




    - 撰寫 Vercel 部署步驟
    - 建立環境變數設定說明
    - 撰寫資料庫設定指南
    - _需求: 10.1, 10.2_

  - [ ] 14.2 建立整合設定指南
    - 撰寫 LINE Bot 設定步驟
    - 建立 SendGrid 設定說明
    - 撰寫 webhook 設定指南
    - _需求: 10.3_

  - [ ] 14.3 建立使用者手冊
    - 撰寫店家註冊指南
    - 建立系統操作說明
    - 撰寫常見問題解答
    - _需求: 10.4, 10.5_

  - [ ] 14.4 建立 README 和專案文件
    - 撰寫專案概述
    - 建立開發環境設定指南
    - 撰寫 API 文件
    - _需求: 9.1_

- [ ] 15. 最終檢查點 - 確保所有測試通過
  - 確保所有測試通過，如有問題請詢問使用者